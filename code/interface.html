<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />

		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

		<title>Politics Game</title>
		
		<meta name="description" content="" />
		<meta name="author" content="Sander Latour and Frank Smit" />

		<meta name="viewport" content="width=device-width; initial-scale=1.0" />

		<!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
		
		<script src="Agent.js"></script>
		<script src="GameController.js"></script>
		<script src="GameState.js"></script>
		<script src="ActionNode.js"></script>
		
		<script>
			function start() {
				var gamecontroller = new GameController();
				
				var _agents = new Array();
				var _actions = new Array();
				var request = new Array();
				
				agent1 = new Agent('Piet', 'bla');
				_agents.push(agent1);
				agent2 = new Agent('John', 'bla');
				_agents.push(agent2);  
				
				action1 = new ActionNode("I want a better world", {"food": -5, "safety": 5 }, undefined);
				_actions.push(action1);
				
				action2 = new ActionNode("I want a sandwidch", {"food": 1, "safety": 5 }, undefined);
				_actions.push(action2);

				for(var i = 0; i < _agents.length; i++) {
					request.push({
		        			"agent": _agents[i],
		        			"action": _actions[i]
      					}
      				);
				};
						    	
		    	// call requestApproval which creates the interface
		    	requestApproval(gamecontroller, request)
		    				
			}

		    function requestApproval(gamecontroller, request) {	
		        // get the reference for the body
		        var mybody = document.getElementsByTagName("body")[0];
				
		        // creates <table> and <tbody> elements
		        mytable     = document.createElement("table");
		        mytablebody = document.createElement("tbody");
		        
				for(var j = 0; j < request.length; j++) {
					
					row = document.createElement("tr");
					row.setAttribute("height", "128px");
					
					row.setAttribute("id", "agent"+j);
					
					cell1 = document.createElement("td");
					text1 =  document.createTextNode(request[j].agent.getName());
					cell1.appendChild(text1);
					
					row.appendChild(cell1);
					
					cell2 = document.createElement("td");
					text2 =  document.createTextNode(request[j].action.getDescription());
					cell2.appendChild(text2);
					
					row.appendChild(cell2);
					
					cell3 = document.createElement("td");
					consequenceText = "";
					
					for(var key in request[j].action.getEffects()) {
						consequenceText += key + " " + request[j].action.getEffects()[key] + ', ';
					}
					//text3 =  document.createTextNode("Environment: " + request[j]["consequence"]["environment"] 
					//	+ "," + " Economy: " + request[j]["consequence"]["economy"]);
					text3 = document.createTextNode(consequenceText);
					cell3.appendChild(text3);
					
					row.appendChild(cell3);
					
					cell4 = document.createElement("td");
					
					var buttonnode = document.createElement('input');
					buttonnode.setAttribute('type','button');
					buttonnode.setAttribute('value','Approve request');
					
					buttonnode.onclick = (function(k){ return function(){
						gamecontroller.perform(request[k].action) }
					})(j);
					
					cell4.appendChild(buttonnode);
					
					row.appendChild(cell4);
					
					mytablebody.appendChild(row);
					
				}
		
		        // appends <tbody> into <table>
		        mytable.appendChild(mytablebody);
		        // appends <table> into <body>
		        mybody.appendChild(mytable);
		        // sets the border attribute of mytable to 2;
		        mytable.setAttribute("border","1");
		        // creating all cells
			}			
		</script>

	</head>
	<body onload="start()">
		
	</body>
</html>
